{"ast":null,"code":"import _classCallCheck from\"/Users/dmitrijivasenko/Desktop/RS-School/projects/currency-exchange/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/dmitrijivasenko/Desktop/RS-School/projects/currency-exchange/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/dmitrijivasenko/Desktop/RS-School/projects/currency-exchange/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/dmitrijivasenko/Desktop/RS-School/projects/currency-exchange/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import'../styles/main.css';import Popup from'./popup';import Tooltip from'./tooltip';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Difference(props){var name=props.currentValue<props.previousValue?'decrease':'increase';return/*#__PURE__*/_jsx(\"span\",{className:name,children:((props.currentValue-props.previousValue)/props.previousValue*100).toFixed(2)+'%'});}var ListItems=/*#__PURE__*/function(_Component){_inherits(ListItems,_Component);var _super=_createSuper(ListItems);function ListItems(){_classCallCheck(this,ListItems);return _super.apply(this,arguments);}_createClass(ListItems,[{key:\"render\",value:function render(){var data=this.props.data;var dataArr=Object.keys(data);return dataArr.map(function(elem){return/*#__PURE__*/_jsxs(\"li\",{className:\"list__item\",children:[/*#__PURE__*/_jsx(Tooltip,{content:data[elem].Name,children:/*#__PURE__*/_jsx(\"span\",{className:\"code\",children:data[elem].CharCode})}),/*#__PURE__*/_jsx(\"span\",{children:Math.round(data[elem].Value).toFixed(2)}),/*#__PURE__*/_jsx(Difference,{currentValue:data[elem].Value,previousValue:data[elem].Previous})]},data[elem].CharCode);});}}]);return ListItems;}(Component);var List=/*#__PURE__*/function(_Component2){_inherits(List,_Component2);var _super2=_createSuper(List);function List(){_classCallCheck(this,List);return _super2.apply(this,arguments);}_createClass(List,[{key:\"render\",value:function render(){var data=this.props.data;return/*#__PURE__*/_jsx(\"ul\",{className:\"list\",children:/*#__PURE__*/_jsx(ListItems,{data:data})});}}]);return List;}(Component);var Main=/*#__PURE__*/function(_Component3){_inherits(Main,_Component3);var _super3=_createSuper(Main);function Main(){var _this;_classCallCheck(this,Main);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super3.call.apply(_super3,[this].concat(args));_this.state={data:{},isVisible:false,targetName:'',content:[]};_this.lastData=[];return _this;}_createClass(Main,[{key:\"componentDidMount\",value:function componentDidMount(){this.fetchData();this.fetchPreviousData(1);}},{key:\"fillPopup\",value:function fillPopup(name){var previousCurrency=[];this.lastData.forEach(function(item){var dateArr=item.date.split('T');var date=dateArr[0].split('-').reverse().join('.');var contentInfo={date:date,currency:item.currency[name].Value};previousCurrency.push(contentInfo);});return previousCurrency;}},{key:\"fetchPreviousData\",value:function fetchPreviousData(i){var _this2=this;var today=Date.now();var yesterday=today-i*86400000;var date=new Date(yesterday);var year=date.getFullYear();var month=date.getMonth()+1;month=month>10?month:\"0\".concat(month);var day=date.getDate();day=day>10?day:\"0\".concat(day);var BASE_PATH=\"https://www.cbr-xml-daily.ru/archive/\".concat(year,\"/\").concat(month,\"/\").concat(day,\"/daily_json.js\");fetch(BASE_PATH).then(function(res){return res.json();}).then(function(result){var info={date:result.Date,currency:result.Valute};_this2.lastData.push(info);if(_this2.lastData.length<10){_this2.fetchPreviousData(i+1);}else{return;}}).catch(function(error){if(error){console.log(\"No data for \".concat(date));_this2.fetchPreviousData(i+1);}});}},{key:\"fetchData\",value:function fetchData(){var _this3=this;var BASE_PATH='https://www.cbr-xml-daily.ru/daily_json.js';fetch(BASE_PATH).then(function(res){return res.json();}).then(function(result){return _this3.setState({data:result.Valute});}).catch(function(error){return error;});}},{key:\"handleClick\",value:function handleClick(event){if(event.target.className=='code'){var name=event.target.innerText;this.setState({isVisible:true,targetName:name,content:this.fillPopup(name)});}}},{key:\"onPopupClose\",value:function onPopupClose(){this.setState({isVisible:false});}},{key:\"render\",value:function render(){var _this4=this;var _this$state=this.state,data=_this$state.data,isVisible=_this$state.isVisible,content=_this$state.content,targetName=_this$state.targetName;return/*#__PURE__*/_jsxs(\"main\",{className:\"main\",onClick:function onClick(event){return _this4.handleClick(event);},children:[/*#__PURE__*/_jsx(Popup,{name:targetName,visibility:isVisible,content:content,onClose:function onClose(){return _this4.onPopupClose();}}),/*#__PURE__*/_jsx(List,{data:data})]});}}]);return Main;}(Component);export default Main;","map":{"version":3,"sources":["/Users/dmitrijivasenko/Desktop/RS-School/projects/currency-exchange/src/components/main.jsx"],"names":["React","Component","Popup","Tooltip","Difference","props","name","currentValue","previousValue","toFixed","ListItems","data","dataArr","Object","keys","map","elem","Name","CharCode","Math","round","Value","Previous","List","Main","state","isVisible","targetName","content","lastData","fetchData","fetchPreviousData","previousCurrency","forEach","item","dateArr","date","split","reverse","join","contentInfo","currency","push","i","today","Date","now","yesterday","year","getFullYear","month","getMonth","day","getDate","BASE_PATH","fetch","then","res","json","result","info","Valute","length","catch","error","console","log","setState","event","target","className","innerText","fillPopup","handleClick","onPopupClose"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport '../styles/main.css';\nimport Popup from './popup';\nimport Tooltip from './tooltip';\n\nfunction Difference(props) {\n  const name =\n    props.currentValue < props.previousValue ? 'decrease' : 'increase';\n\n  return (\n    <span className={name}>\n      {(((props.currentValue - props.previousValue) / props.previousValue) * 100).toFixed(2) + '%'}\n    </span>\n  );\n}\n\nclass ListItems extends Component {\n  render() {\n    const { data } = this.props;\n    const dataArr = Object.keys(data);\n    return dataArr.map((elem) => (\n      <li className=\"list__item\" key={data[elem].CharCode}>\n        <Tooltip content={data[elem].Name}>\n          <span className=\"code\">{data[elem].CharCode}</span>\n        </Tooltip>\n        <span>{Math.round(data[elem].Value).toFixed(2)}</span>\n        <Difference\n          currentValue={data[elem].Value}\n          previousValue={data[elem].Previous}\n        />\n      </li>\n    ));\n  }\n}\n\nclass List extends Component {\n  render() {\n    const { data } = this.props;\n    return (\n      <ul className=\"list\">\n        <ListItems data={data} />\n      </ul>\n    );\n  }\n}\n\nclass Main extends Component {\n  state = {\n    data: {},\n    isVisible: false,\n    targetName: '',\n    content: [],\n  };\n\n  lastData = [];\n\n  componentDidMount() {\n    this.fetchData();\n    this.fetchPreviousData(1);\n  }\n\n  fillPopup(name) {\n    const previousCurrency = [];\n    this.lastData.forEach((item) => {\n      const dateArr = item.date.split('T');\n      const date = dateArr[0].split('-').reverse().join('.');\n      const contentInfo = {\n        date: date,\n        currency: item.currency[name].Value,\n      };\n      previousCurrency.push(contentInfo);\n    });\n    return previousCurrency;\n  }\n\n  fetchPreviousData(i) {\n    const today = Date.now();\n    let yesterday = today - i * 86400000;\n    const date = new Date(yesterday);\n    const year = date.getFullYear();\n    let month = date.getMonth() + 1;\n    month = month > 10 ? month : `0${month}`;\n    let day = date.getDate();\n    day = day > 10 ? day : `0${day}`;\n    let BASE_PATH = `https://www.cbr-xml-daily.ru/archive/${year}/${month}/${day}/daily_json.js`;\n\n    fetch(BASE_PATH)\n      .then((res) => res.json())\n      .then((result) => {\n        const info = {\n          date: result.Date,\n          currency: result.Valute,\n        };\n        this.lastData.push(info);\n        if (this.lastData.length < 10) {\n          this.fetchPreviousData(i + 1);\n        } else {\n          return;\n        }\n      })\n      .catch((error) => {\n        if (error) {\n          console.log(`No data for ${date}`);\n          this.fetchPreviousData(i + 1);\n        }\n      });\n  }\n\n  fetchData() {\n    const BASE_PATH = 'https://www.cbr-xml-daily.ru/daily_json.js';\n\n    fetch(BASE_PATH)\n      .then((res) => res.json())\n      .then((result) => this.setState({ data: result.Valute }))\n      .catch((error) => error);\n  }\n\n  handleClick(event) {\n    if (event.target.className == 'code') {\n      const name = event.target.innerText;\n      this.setState({\n        isVisible: true,\n        targetName: name,\n        content: this.fillPopup(name),\n      });\n    }\n  }\n\n  onPopupClose() {\n    this.setState({ isVisible: false });\n  }\n\n  render() {\n    const { data, isVisible, content, targetName } = this.state;\n    return (\n      <main className=\"main\" onClick={(event) => this.handleClick(event)}>\n        <Popup\n          name={targetName}\n          visibility={isVisible}\n          content={content}\n          onClose={() => this.onPopupClose()}\n        />\n        <List data={data} />\n      </main>\n    );\n  }\n}\n\nexport default Main;\n"]},"metadata":{},"sourceType":"module"}